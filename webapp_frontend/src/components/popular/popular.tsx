'use client'
import {IProduct} from "@/types/products.interface";
import styles from "./popular.module.scss"
import Image from "next/image";
import ButtonAdd from "@/components/ui/button-add/button";
import {useEffect, useState} from "react";
import {useCart} from "@/components/store/store";
import ActionButtons from "@/components/ui/action-buttons/action-buttons";
import {Shimmer} from "react-shimmer";
import shimmer from "@/components/ui/shimmer/shimmer.module.scss"
import Link from "next/link";
import {CartItem} from "@/types/store.interface";
import PupularBg from "@/images/popular_bg";
import PopularBg from "@/images/popular_bg";
function Popular(props: { data: IProduct[] }) {
    const { items } = useCart()
    const [clientItems, setClientItems] = useState<CartItem[]>([]); // Замените `ClientItem` на ваш фактический тип

    useEffect(() => {
        setClientItems(items)
    }, [items])

    const [isLoading, setLoading] = useState(false);

    // useEffect(() => {
    //     setLoading(true);
    //     const timeoutId = setTimeout(() => {
    //         setLoading(false);
    //     }, 1000);

    //     return () => clearTimeout(timeoutId);
    // }, []);

    return (
        <div className={styles.popular}>
            {props.data.map((product: IProduct) => {
                const cartItem = clientItems.find((i) => i.id === product.id)
                const count = cartItem ? cartItem.count : 0

                return (
                    <Link href={`/product/${product.id}`} className={styles.item} key={product.id}>
                        <div className={styles.type}>
                            {product.login_type === "EMAIL_CODE" ? (
                                <svg width="15" height="16" viewBox="0 0 15 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2.09474 2.81615C1.90251 2.80853 1.71164 2.84932 1.54215 2.93424C1.37267 3.01916 1.23083 3.14508 1.13153 3.29877C0.3919 4.40816 -2.08729e-05 5.68848 0.000122109 6.99484C0.000122109 7.25985 0.113003 7.514 0.313932 7.70139C0.514861 7.88878 0.787379 7.99405 1.07154 7.99405C1.35569 7.99405 1.62821 7.88878 1.82914 7.70139C2.03007 7.514 2.14295 7.25985 2.14295 6.99484C2.14295 6.06158 2.42366 5.1463 2.95187 4.35393C3.05364 4.20594 3.11175 4.03552 3.12031 3.85989C3.12888 3.68426 3.0876 3.50962 3.00065 3.35363C2.9137 3.19763 2.78416 3.06579 2.6251 2.97142C2.46604 2.87705 2.28309 2.82349 2.09474 2.81615Z" fill="#6AEC3D" />
                                    <path fillRule="evenodd" clipRule="evenodd" d="M1.05438 5.98164C0.770586 5.98584 0.500181 6.0949 0.302521 6.28486C0.104861 6.47482 -0.00390241 6.73016 0.000107047 6.99483V12.0538C0.000107047 12.3188 0.112988 12.573 0.313917 12.7604C0.514846 12.9478 0.787364 13.053 1.07152 13.053C1.35568 13.053 1.6282 12.9478 1.82912 12.7604C2.03005 12.573 2.14293 12.3188 2.14293 12.0538V6.99483C2.14496 6.86109 2.11817 6.72832 2.06416 6.60441C2.01014 6.4805 1.93 6.36796 1.82848 6.27347C1.72697 6.17898 1.60614 6.10446 1.47317 6.05433C1.3402 6.0042 1.19779 5.97948 1.05438 5.98164Z" fill="#6AEC3D" />
                                    <path d="M7.50007 2.998C5.1451 2.998 3.21442 4.79958 3.21442 6.99484C3.21442 7.25984 3.3273 7.514 3.52823 7.70139C3.72916 7.88877 4.00167 7.99405 4.28583 7.99405C4.56999 7.99405 4.8425 7.88877 5.04343 7.70139C5.24436 7.514 5.35724 7.25984 5.35724 6.99484C5.35724 5.87972 6.3033 4.99642 7.50007 4.99642C8.69577 4.99642 9.6429 5.87972 9.6429 6.99484C9.6429 7.25984 9.75578 7.514 9.95671 7.70139C10.1576 7.88877 10.4302 7.99405 10.7143 7.99405C10.9985 7.99405 11.271 7.88877 11.4719 7.70139C11.6728 7.514 11.7857 7.25984 11.7857 6.99484C11.7857 4.79958 9.85396 2.998 7.50007 2.998Z" fill="#6AEC3D" />
                                    <path fillRule="evenodd" clipRule="evenodd" d="M7.48285 5.98164C7.19906 5.98584 6.92865 6.0949 6.73099 6.28486C6.53333 6.47482 6.42457 6.73016 6.42858 6.99483V11.9909C6.42858 11.9909 6.42751 12.5854 6.58286 13.3098C6.73822 14.0353 7.02536 14.9595 7.81392 15.6949C7.91275 15.7904 8.03098 15.8665 8.16169 15.9189C8.29241 15.9712 8.433 15.9988 8.57526 16C8.71753 16.0011 8.85861 15.9758 8.99028 15.9256C9.12195 15.8753 9.24158 15.8012 9.34218 15.7073C9.44277 15.6135 9.52233 15.502 9.5762 15.3792C9.63007 15.2564 9.65718 15.1248 9.65595 14.9921C9.65471 14.8594 9.62515 14.7283 9.569 14.6064C9.51285 14.4845 9.43123 14.3742 9.3289 14.2821C9.04497 14.0183 8.7964 13.4437 8.68391 12.9201C8.57141 12.3956 8.57141 11.9909 8.57141 11.9909V6.99483C8.57343 6.86109 8.54665 6.72832 8.49263 6.60441C8.43862 6.4805 8.35847 6.36796 8.25696 6.27347C8.15544 6.17898 8.03461 6.10446 7.90164 6.05433C7.76867 6.0042 7.62626 5.97948 7.48285 5.98164ZM4.26861 5.98164C3.98482 5.98584 3.71441 6.0949 3.51675 6.28486C3.31909 6.47482 3.21033 6.73016 3.21434 6.99483V7.99404C3.21434 8.25905 3.32722 8.5132 3.52815 8.70059C3.72908 8.88798 4.0016 8.99325 4.28575 8.99325C4.56991 8.99325 4.84243 8.88798 5.04336 8.70059C5.24429 8.5132 5.35717 8.25905 5.35717 7.99404V6.99483C5.35919 6.86109 5.33241 6.72832 5.27839 6.60441C5.22438 6.4805 5.14423 6.36796 5.04272 6.27347C4.9412 6.17898 4.82037 6.10446 4.6874 6.05433C4.55443 6.0042 4.41202 5.97948 4.26861 5.98164ZM4.26861 9.97847C3.98482 9.98268 3.71441 10.0917 3.51675 10.2817C3.31909 10.4717 3.21033 10.727 3.21434 10.9917V13.9893C3.21434 14.2543 3.32722 14.5085 3.52815 14.6958C3.72908 14.8832 4.0016 14.9885 4.28575 14.9885C4.56991 14.9885 4.84243 14.8832 5.04336 14.6958C5.24429 14.5085 5.35717 14.2543 5.35717 13.9893V10.9917C5.35919 10.8579 5.33241 10.7252 5.27839 10.6012C5.22438 10.4773 5.14423 10.3648 5.04272 10.2703C4.9412 10.1758 4.82037 10.1013 4.6874 10.0512C4.55443 10.001 4.41202 9.97632 4.26861 9.97847ZM10.6971 5.98164C10.4133 5.98584 10.1429 6.0949 9.94523 6.28486C9.74757 6.47482 9.63881 6.73016 9.64282 6.99483V11.9909C9.64282 11.9909 9.65246 12.4305 9.83032 12.9311C10.0777 13.5979 10.4878 14.202 11.0282 14.6957C11.127 14.7912 11.2452 14.8673 11.3759 14.9197C11.5067 14.972 11.6472 14.9996 11.7895 15.0007C11.9318 15.0019 12.0728 14.9766 12.2045 14.9264C12.3362 14.8761 12.4558 14.8019 12.5564 14.7081C12.657 14.6143 12.7366 14.5027 12.7904 14.3799C12.8443 14.2571 12.8714 14.1256 12.8702 13.9929C12.8689 13.8602 12.8394 13.7291 12.7832 13.6072C12.7271 13.4853 12.6455 13.375 12.5431 13.2829C12.1328 12.9012 11.9539 12.5474 11.8649 12.2996C11.7749 12.0508 11.7856 11.9909 11.7856 11.9909V6.99483C11.7877 6.86109 11.7609 6.72832 11.7069 6.60441C11.6529 6.4805 11.5727 6.36796 11.4712 6.27347C11.3697 6.17898 11.2489 6.10446 11.1159 6.05433C10.9829 6.0042 10.8405 5.97948 10.6971 5.98164ZM13.9113 5.98164C13.6275 5.98584 13.3571 6.0949 13.1595 6.28486C12.9618 6.47482 12.8531 6.73016 12.8571 6.99483V7.99404C12.8571 8.25905 12.9699 8.5132 13.1709 8.70059C13.3718 8.88798 13.6443 8.99325 13.9285 8.99325C14.2126 8.99325 14.4851 8.88798 14.6861 8.70059C14.887 8.5132 14.9999 8.25905 14.9999 7.99404V6.99483C15.0019 6.86109 14.9751 6.72832 14.9211 6.60441C14.8671 6.4805 14.787 6.36796 14.6854 6.27347C14.5839 6.17898 14.4631 6.10446 14.3301 6.05433C14.1971 6.0042 14.0547 5.97948 13.9113 5.98164Z" fill="#6AEC3D" />
                                    <path d="M7.5771 0.000375874C6.26955 -0.0122687 4.98121 0.294312 3.84001 0.889672C3.71711 0.953575 3.60891 1.03943 3.52158 1.14233C3.43426 1.24523 3.36952 1.36317 3.33107 1.4894C3.29262 1.61563 3.2812 1.7477 3.29747 1.87805C3.31375 2.00839 3.35739 2.13448 3.42591 2.2491C3.49443 2.36372 3.58649 2.46462 3.69682 2.54606C3.80716 2.6275 3.93362 2.68788 4.06897 2.72374C4.20433 2.7596 4.34594 2.77025 4.4857 2.75507C4.62547 2.7399 4.76067 2.69919 4.88357 2.63529C5.69867 2.20963 6.61902 1.99029 7.55316 1.99905C8.48731 2.00782 9.40273 2.24438 10.2085 2.68525C11.0149 3.12551 11.6837 3.75496 12.1483 4.51102C12.613 5.26708 12.8573 6.1234 12.857 6.99484C12.857 7.25985 12.9699 7.514 13.1708 7.70139C13.3718 7.88878 13.6443 7.99405 13.9284 7.99405C14.2126 7.99405 14.4851 7.88878 14.686 7.70139C14.887 7.514 14.9999 7.25985 14.9999 6.99484C14.9992 5.775 14.6568 4.57648 14.0066 3.51805C13.3564 2.45962 12.4208 1.57802 11.2928 0.960616C10.1656 0.343884 8.88497 0.0128488 7.57817 0.000375874H7.5771Z" fill="#6AEC3D" />
                                    <path d="M14.9999 10.9917C14.9999 11.2567 14.8871 11.5108 14.6861 11.6982C14.4852 11.8856 14.2127 11.9909 13.9285 11.9909C13.6444 11.9909 13.3719 11.8856 13.1709 11.6982C12.97 11.5108 12.8571 11.2567 12.8571 10.9917C12.8571 10.7266 12.97 10.4725 13.1709 10.2851C13.3719 10.0977 13.6444 9.99245 13.9285 9.99245C14.2127 9.99245 14.4852 10.0977 14.6861 10.2851C14.8871 10.4725 14.9999 10.7266 14.9999 10.9917Z" fill="#6AEC3D" />
                                </svg>
                            ) : (
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7 3H3C1.89543 3 1 3.89543 1 5V15C1 16.1046 1.89543 17 3 17H13C14.1046 17 15 16.1046 15 15V11M11 1H17M17 1V7M17 1L7 11" stroke="#FDB834" strokeLinecap="round" strokeLinejoin="round" />
                                </svg>
                            )}
                        </div>
                        <div className={styles.content}>
                            <div className={styles.img}>
                                {/* <Image src={product.images[0].original} alt={product.title} objectFit="cover" fill/> */}
                                <Image 
  src={product.images[0].original}
  alt={product.title}
  fill
  sizes="(max-width: 768px) 100vw, 50vw"
  priority
  className="object-contain"
/>
                            </div>
                            <div className={styles.container}>
                                <div className={styles.name}>
                                    <h3>{product.categories}</h3>
                                    <h4>{product.title}</h4>
                                </div>
                                <div className={styles.actions}>
                                    <p>{product.price.incl_tax} ₽</p>
                                    <div className={styles.cart_action}>
                                        {isLoading ? (
                                            <Shimmer width={120} height={31} className={`${shimmer.shimmer_btn} shimmer`} />
                                        ) : count < 1 ? (
                                            <ButtonAdd id={product.id} game={product.game}/>
                                        ) : (
                                            <ActionButtons id={product.id} count={count} game={product.game}/>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className={styles.bg}>
                            <PopularBg/>
                        </div>
                    </Link>
                )
            })}
        </div>
    )
}

export default Popular